import{d as Q,r,B as S,K as W,e as X,h as a,w as p,f as ee,J as O,j as s,o as ae,g as B,S as z,m as P,x as E,_ as le}from"./index-CS97xECk.js";import{a as te}from"./fault-4m_H0PCC.js";import{l as ne,P as oe}from"./lodash-Cu6ATtqO.js";import{g as re,G as ce}from"./wokingtion-B2wKtcAy.js";import"./index-Bwm8AFsF.js";const ue={class:"box"},se={style:{flex:"1"}},pe=Q({__name:"index",setup(ie){const f=r(""),h=r([]),F=r(),v=r(),N=r([]),C=r(-1),b=r(0),L=r(1),M=r(10),D=r([]),Y=r({children:"children",label:"ELEOFFNAME",value:"ELEOFFID"}),d=r(""),g=r(!1),T=r(!1),y=r({}),k=r(!1),H=(e,{rowIndex:t})=>{C.value=t},$=({rowIndex:e})=>{if(e===C.value)return"active-row"},i=async()=>{d.value?await w(d.value):await w()},U=e=>{y.value=e,k.value=!0},w=async(e="")=>{const t=O.get("Token");try{const c=F.value||"",n=v.value||"",_=await te({deviceType:"-1",faultFlag:"0",warningDataType:"2",mlineid:e,netMlineid:"",startTime:c,endTime:n,pageSize:M.value.toString(),page:L.value.toString(),token:t});if(Number(_.Code)===1){const m=JSON.parse(_.Message);N.value=m.map(l=>({FaultTime:`${l.FaultTime.replace("T"," ")} ${l.FaultTimeMS}`,FaultLine:`${l.FMLName}`,NetMLName:l.NetMLName,FLineVolevel:l.FLineVolevel,FaultPole:l.FElepoName,FaultNature:l.FaultNature,FaultType:l.FaultType,SMLName:l.SMLName,SElepoName:l.SElepoName,EMLName:l.EMLName,EElepoName:l.EElepoName,FaultDistance:l.FaultDistance,FaultDirection:l.FaultDirection,FaultSection:l.FaultSection,FaultSLType:l.FaultSLType,CHZFlag:l.CHZFlag,FEleoffName:l.FEleoffName||"无",hiddendanger:l.NetMLName?`${l.FMLName} ${l.FElepoName}`:l.FElepoName,line:l.NetMLName?l.FMLName:l.FElepoName,FMLName:`${l.FMLName}`,DurationTime:l.DurationTime,FaultID:l.FaultID,FaultDescription:""})),b.value=m.length>0?m[0].Total:0}else N.value=[],b.value=0}catch(c){console.error("获取告警信息失败:",c)}},J=e=>{L.value=e,i()},R=e=>{M.value=e,i()},V=async()=>{const e=O.get("Token");try{const t=await re(e);if(t.Code===1){const c=JSON.parse(t.Message);if(D.value=c.map(n=>({...n,children:g.value?[]:[]})),!g.value&&!T.value){const n=await ce(e);if(n.Code===1){const _=JSON.parse(n.Message);D.value.forEach(m=>{x(m,_)}),T.value=!0}}}}catch(t){console.error("获取数据失败:",t)}};function x(e,t){if(!e||!t||!t.length)return;const c=t.filter(n=>n.ELEOFFID===e.ELEOFFID);c.length&&(e.children||(e.children=[]),c.forEach(n=>{e.children.push({ELEOFFID:n.MLINEID,ELEOFFNAME:n.MLNAME,PELEOFFID:n.ELEOFFID,ELEOFFEVEL:2,children:[]})})),e.children&&e.children.forEach(n=>x(n,t))}const A=e=>{e?(d.value=e,i()):(d.value="",i())},G=async()=>{T.value=!1,await V()};S(h,(e,t)=>{if(F.value=e?e[0]:"",v.value=e?e[1]:"",v.value&&F.value&&v.value<F.value){const c=v.value;v.value=F.value,F.value=c}i()},{immediate:!0}),S(d,(e,t)=>{e!==t&&i()}),W(()=>{V()});const Z=ne.debounce(i,300);return S(f,()=>{Z()},{immediate:!0}),(e,t)=>{const c=s("el-input"),n=s("el-form-item"),_=s("el-date-picker"),m=s("el-tree-select"),l=s("el-switch"),I=s("el-button"),j=s("el-form"),o=s("el-table-column"),q=s("el-table"),K=s("el-pagination");return ae(),X("div",ue,[a(j,{inline:!0,class:"form"},{default:p(()=>[a(n,null,{default:p(()=>[a(c,{placeholder:"输入关键字",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=u=>f.value=u),"prefix-icon":B(z)},null,8,["modelValue","prefix-icon"])]),_:1}),a(n,null,{default:p(()=>[a(_,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=u=>h.value=u),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),a(n,null,{default:p(()=>[a(m,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=u=>d.value=u),data:D.value,props:Y.value,"value-key":"ELEOFFID",placeholder:"请选择线路",onChange:A,class:"selectStyle",clearable:""},null,8,["modelValue","data","props"]),a(l,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=u=>g.value=u),"active-text":"复杂线路",onChange:G},null,8,["modelValue"])]),_:1}),a(n,null,{default:p(()=>[a(I,{size:"default",disabled:!f.value,onClick:i,icon:B(z)},{default:p(()=>[P(" 搜索 ")]),_:1},8,["disabled","icon"])]),_:1})]),_:1}),ee("div",se,[a(q,{data:N.value,onRowClick:H,"row-class-name":$},{default:p(()=>[a(o,{label:"故障时间",align:"center",prop:"FaultTime",width:"200px"}),a(o,{label:"故障线路",align:"center",prop:"FaultLine",width:"100px"}),a(o,{label:"故障复杂线路",align:"center",prop:"NetMLName"}),a(o,{label:"故障线路电压等级kV",align:"center",prop:"FLineVolevel"}),a(o,{label:"故障杆塔",align:"center",prop:"FaultPole"}),a(o,{label:"故障性质",align:"center",prop:"FaultNature"}),a(o,{label:"故障类型",align:"center",prop:"FaultType"}),a(o,{label:"故障起始线路",align:"center",prop:"SMLName"}),a(o,{label:"故障起始杆塔",align:"center",prop:"SElepoName"}),a(o,{label:"故障终止线路",align:"center",prop:"EMLName"}),a(o,{label:"故障终止杆塔",align:"center",prop:"EElepoName"}),a(o,{label:"故障距离",align:"center",prop:"FaultDistance"}),a(o,{label:"故障方向",align:"center",prop:"FaultDirection"}),a(o,{label:"故障区间",align:"center",prop:"FaultSection"}),a(o,{label:"故障相别",align:"center",prop:"FaultSLType"}),a(o,{label:"重合闸状态",align:"center",prop:"CHZFlag"}),a(o,{label:"故障所属局",align:"center",prop:"FEleoffName"}),E("",!0),E("",!0),E("",!0),E("",!0),a(o,{label:"操作",align:"center",width:"100px"},{default:p(({row:u})=>[a(I,{onClick:de=>U(u)},{default:p(()=>[P("预览")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),a(oe,{selectedFault:y.value,visible:k.value,"onUpdate:visible":t[4]||(t[4]=u=>k.value=u)},null,8,["selectedFault","visible"]),a(K,{"current-page":L.value,"page-size":M.value,total:b.value,"page-sizes":[10,20,30,50],layout:"prev, pager, next, jumper, ->, sizes, total",background:!0,onCurrentChange:J,onSizeChange:R,"pager-count":3},null,8,["current-page","page-size","total"])])}}}),ge=le(pe,[["__scopeId","data-v-bbd8f26f"]]);export{ge as default};
